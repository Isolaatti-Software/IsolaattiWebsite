@page
@model isolaatti_API.Pages.Profile

@{
    Layout = "Shared/_LayoutWebApp";
    ViewData["Title"] = ViewData["profile_name"];
}


<div class="col-lg-2 col-md-4 p-0">
    <header id="left-bar" class="p-2">
        <div class="d-flex justify-content-center">
            @if (Model.ProfilePhotoUrl == null)
            {
                <div class="profile-pic mt-3">
                    <i class="fas fa-user"></i>
                </div>
            }
            else
            {
                <img src="@Model.ProfilePhotoUrl" width="100" height="100" class="profile-pic mt-3"/>
            }
        </div>
        <div class="translucent-white-card" style="margin-top: 30px;">
            <p class="text-center m-0 overflow-auto text-break username-profile">@ViewData["profile_name"]</p>
            <p class="text-center text-break">@ViewData["description"]</p>
            <div class="d-flex mt-2 flex-column">
                <div class="btn-group btn-group-sm">
                    <a class="btn btn-link"
                       data-toggle="modal" href="#modal-followers">
                        Followers: <b>@ViewData["numberOfFollowers"]</b>
                    </a>
                    <a class="btn btn-link"
                       data-toggle="modal" href="#modal-following">
                        Following: <b>@ViewData["numberOfFollowing"]</b>
                    </a>
                </div>
                @if ((bool) ViewData["thisUserIsFollowingMe"])
                {
                    <span class="text-center mb-2 p-2 mr-1 badge badge-pill badge-success">
                        <i class="fas fa-user-friends"></i> Follows you
                    </span>
                }
                <div class="card">
                    <ul class="list-group list-group-flush">
                        <li class="list-group-item d-flex justify-content-between align-items-center">
                            Likes 
                            <span class="badge badge-primary badge-pill">@ViewData["numberOfLikes"]</span>
                        </li>
                        <li class="list-group-item d-flex justify-content-between align-items-center">
                            Posts
                            <div class="badge badge-primary badge-pill">
                                @ViewData["numberOfPosts"]
                            </div>
                        </li>
                    </ul>
                </div>
            </div>
            <div class="d-flex mt-1">
                @if ((bool) ViewData["followingThisUser"])
                {
                    <button class="btn btn-primary btn-sm mb-2 w-100" id="followButton">Unfollow <i class="fas fa-times"></i></button>
                }
                else
                {
                    <button class="btn btn-primary btn-sm mb-2 w-100" id="followButton">Follow <i class="fas fa-check"></i></button>
                }
            </div>
            <div style="height: 10px"></div>
        </div>
    </header>
</div>
<div class="col-lg-7 col-md-9">
    <section class="mt-3 d-flex flex-column">
        <h5 class="m-3"><i class="far fa-newspaper"></i> Posts</h5>
        <section id="vue-container" class="d-flex flex-column pt-1 mt-2 mb-3 align-items-center">
            @if ((int)ViewData["numberOfPosts"] == 0)
            {
                <h5 class="m-2 text-center">@ViewData["profile_name"] does not have any public post</h5>
            }
            <div v-if="loading" class="d-flex justify-content-center mt-2">
                <div class="spinner-border" role="status">
                    <span class="sr-only">Loading more content...</span>
                </div>
            </div>
            <post-template v-for="post in posts" :post="post"
                           v-on:like="likePost(post)"
                           v-on:un-like="unLikePost(post)"
                           v-model="postLinkToShare"
                           v-on:delete="deletePost(post.id)"
                           v-on:play-audio="playAudio(post.audioAttachedUrl)"
                           :audio-url="audioUrl"
                           :paused="paused"
                           :is-modal="false"
                           v-on:view-thread="viewComments(post)">
            </post-template>
            <div class="modal fade" id="modal-share-post">
                <div class="modal-dialog-centered modal-dialog">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title">
                                Share post
                            </h5>
                            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                <span aria-hidden="true">&times;</span>
                            </button>
                        </div>
                        <div class="modal-body">
                            <p>
                                Use this link to share post
                            </p>
                            <button class="btn btn-primary" v-on:click="copyToClipboard(postLinkToShare)">Copy to clipboard</button>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="modal fade" id="thread-viewer">
                <div class="modal-dialog modal-dialog-scrollable modal-dialog-centered modal-xl">
                    <div class="modal-content">
                        <div class="modal-header">
                            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                <span aria-hidden="true">&times;</span>
                            </button>
                        </div>
                        <div class="modal-body">
                            <comment v-for="comment in commentsViewer.comments"
                                     :comment="comment"
                                     :audio-url="audioUrl"
                                     :paused="paused"
                                     v-on:play-audio="playAudio(comment.audioUrl)">
                            </comment>
                        </div>
                        <div class="modal-footer">
                            <span><a :href="openThreadLink" target="_blank">Open thread</a></span>
                        </div>
                    </div>
                </div>
            </div>
        </section>
    </section>

</div>
<div class="col-lg-3"></div>

@section Scripts
{
    <script>
    let thisProfileId = @ViewData["profile_id"];
    let thisUserIsFollowingMe = "@ViewData["thisUserIsFollowingMe"]" === "True";
    let followingThisUser = "@ViewData["followingThisUser"]" === "True";
    </script>
    <script>
    let accountData = {
        userId: @ViewData["profile_id"]
    }
    </script>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <script src="~/js/VueComponents/postComponent.js"></script>
    <script src="~/js/VueComponents/commentComponent.js"></script>
    <script src="~/js/profile.js"></script>
}
