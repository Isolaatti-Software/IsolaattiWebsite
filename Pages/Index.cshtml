@page
@model isolaatti_API.Pages.Index

@{
    Layout = "Shared/_LayoutWebApp";
    ViewData["Title"] = "Inicio";
}

@section CSS
{
    <script>const pageTitle = "Inicio"</script>
}

<div class="col-lg-9 col-md-8">
    <main class="mt-4" id="vue-container">

        <div class="d-flex align-items-center flex-column"
             id="feed-and-thread-reader-container"
             ref="feedAndThreadReaderContainer">
            <div class="sticky-sm-top">
                <h5 class="ml-2 mt-2"><i class="far fa-newspaper"></i> Actividad de las personas que sigues</h5>
            </div>
            <section id="posts-deposit" class="d-flex flex-column pt-1 mt-2 mb-3 align-items-center posts-deposit">
                <post-template v-for="post in posts" :post="post.postData"
                               v-on:like="likePost(post.postData, $event)"
                               v-bind:theme="post.theme"
                               v-on:un-like="unLikePost(post.postData, $event)"
                               v-model="postLinkToShare"
                               v-on:delete="deletePost(post.postData.id)"
                               v-on:play-audio="playAudio(post.postData.audioUrl)"
                               :paused="paused"
                               v-on:view-thread="viewComments(post.postData)"
                               v-bind:audio-url="audioUrl"
                               v-bind:key="post.postData.id">
                </post-template>
                <div v-if="loading" class="d-flex justify-content-center mt-2">
                    <div class="spinner-border" role="status">
                        <span class="sr-only">Cargando más contenido...</span>
                    </div>
                </div>
                <div v-if="noMoreContent" class="d-flex flex-column align-items-center mt-2">
                    <p>Ya viste toda la actividad por ahora, refresca en un momento...</p>
                    <button class="btn btn-primary" v-on:click="refresh()">
                        <i class="fas fa-redo"></i>
                    </button>
                </div>
                <div v-else>
                    <button class="btn btn-primary" v-on:click="fetchFeed()">Cargar más</button>
                </div>
            </section>
        </div>

        <div class="modal fade" id="modal-share-post">
            <div class="modal-dialog-centered modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title">
                            Compartir publicación
                        </h5>
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                            <span aria-hidden="true">&times;</span>
                        </button>
                    </div>
                    <div class="modal-body">
                        <p>
                            Usa este enlace para compartir la publicación
                        </p>
                        <button class="btn btn-primary" v-on:click="copyToClipboard(postLinkToShare)">Copiar al portapapeles</button>
                    </div>
                </div>
            </div>
        </div>

        <div class="modal fade" id="thread-viewer">
            <div class="modal-dialog modal-dialog-scrollable modal-dialog-centered modal-xl">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title">Comentarios</h5>
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                            <span aria-hidden="true">&times;</span>
                        </button>
                    </div>
                    <div class="modal-body">
                        <h5 v-if="commentsViewer.comments.length===0" class="m-4 text-center"><i class="fas fa-sad-tear"></i> No hay comentarios que mostrar</h5>
                        <comment v-for="comment in commentsViewer.comments"
                                 :comment="comment"
                                 :audio-url="audioUrl"
                                 :paused="paused"
                                 v-on:play-audio="playAudio(comment.audioUrl)">
                        </comment>
                    </div>
                    <div class="modal-footer">
                        <span>
                            <a :href="openThreadLink" target="_blank">Abrir discusión</a>
                        </span>
                    </div>
                </div>
            </div>
        </div>
    </main>
</div>
<div class="col-lg-3 col-md-4">
    <footer class="mt-4">
        <p class="text-center text-black-50 isolaatti-name-footer">
            Isolaatti
        </p>
        <p class="text-center font-weight-lighter">
            <a href="https://github.com/erik-everardo/Isolaatti-BackendWebApp" class="link">Código fuente</a>
            <a href="https://play.google.com/store/apps/details?id=com.erik.isolaatti" class="link">App</a>
            <a asp-page="/About" class="link">Acerca de</a>
            <a asp-page="/s/Legal/PrivacyPolicy" class="link">Política de privacidad y cookies</a>
            <a asp-page="/s/Legal/TermsOfUse" class="link">Términos de uso</a>
            <a href="https://ayuda.isolaatti.com/" class="link">Ayuda</a>
            <a href="https://blog.isolaattisoftware.com.mx/" target="_blank" class="link">Blog</a>
        </p>
        <p class="text-center text-black-50">
            hecho con <i class="fas fa-heart" style="color: red"></i> por <em>Erik Cavazos</em>, 2020 - 2022
        </p>
    </footer>
</div>


@section Scripts
{
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <script src="~/js/lib/purify.min.js"></script>
    <script src="~/js/VueComponents/postComponent.js"></script>
    <script src="~/js/VueComponents/commentComponent.js"></script>
    <script src="~/js/main_page.js"></script>
}
