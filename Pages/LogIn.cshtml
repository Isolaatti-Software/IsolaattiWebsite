@page "/IniciaSesion"
@model isolaatti_API.Pages.LogIn

@{
    Layout = "Shared/_LayoutWebAppOutside";
    ViewData["Title"] = "Login";
}

@section scripts_google
{
    <script>
        var firebaseConfig = {
            apiKey: "AIzaSyDZHVXLR_1imwVb2mCArnYpdbNx6XUPZBQ",
            authDomain: "isolaatti-b6641.firebaseapp.com",
            databaseURL: "https://isolaatti-b6641.firebaseio.com",
            projectId: "isolaatti-b6641",
            storageBucket: "isolaatti-b6641.appspot.com",
            messagingSenderId: "556033448926",
            appId: "1:556033448926:web:35759afc37d6a1585b1b4f",
            measurementId: "G-JQV4WX75RK"
        };
        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
                      
        var uiConfig = {
                signInSuccessUrl: 'GoogleAuth',
                signInOptions: [
                  // Leave the lines as is for the providers you want to offer your users.
                  firebase.auth.GoogleAuthProvider.PROVIDER_ID,
                  firebase.auth.FacebookAuthProvider.PROVIDER_ID,
                  "microsoft.com"
                ],
                // tosUrl and privacyPolicyUrl accept either url string or a callback
                // function.
                // Terms of service url/callback.
                tosUrl: '/s/Legal/TermsOfUse',
                // Privacy policy url/callback.
                privacyPolicyUrl: '/s/Legal/PrivacyPolicy'
              };
        
              // Initialize the FirebaseUI Widget using Firebase.
              var ui = new firebaseui.auth.AuthUI(firebase.auth());
              // The start method will wait until the DOM is loaded.
              ui.start('#firebaseui-auth-container', uiConfig);
        </script>
}

@section metadata
{
    <meta property="og:url" content="https://isolaatti.com/LogIn"/>
    <meta property="og:type" content="website"/>
    <meta property="og:description" content="Inicia sesión. Isolaatti is una red social basada en publicaciones de audio y texto."/>
    <meta property="og:image" content="https://isolaatti.com/res/imgs/metadata-image-isolaatti.png"/>
}

<nav class="welcome-page-navbar">
    <a asp-page="/s/Welcome">Bienvenido</a>
    <a asp-page="/s/Welcome" asp-fragment="features">Características</a>
    <a asp-page="/About">Acerca de</a>
</nav>
@* @if (Model.NewUser) *@
@* { *@
@*     <div class="alert alert-info"> *@
@*         <h5>Welcome, before logging in the first time, verify your email</h5> *@
@*         <p>We've sent you a message with a link!</p> *@
@*     </div> *@
@* } *@
@* @if (Model.JustVerifiedEmail) *@
@* { *@
@*     <div class="alert alert-info"> *@
@*         <h5>Your email was verified succesfully</h5> *@
@*         <p>Now you can log in here or the Android application!</p> *@
@*     </div> *@
@* } *@
@if (Model.ChangedPassword)
{
    <div class="alert alert-info">
        Tu contraseña se cambió exitosamente. Ingresa tu contraseña para continuar.
    </div>
}

@if (Model.ExistingSession)
{
    <div class="alert alert-info">
        Parece que haz iniciado sesión como <strong>@ViewData["GuessedUsername"]</strong>. ¿Deseas continuar?<br><a asp-page="/Index">Continuar</a>
    </div>
}

<div class="d-flex col-lg-7 col-md-6 flex-column">
    <form method="POST" class="sign-in-up-form" asp-antiforgery="false">
        <h2>Iniciar sesión</h2>
        <p>
            <a asp-page="MakeAccount">Regístrate</a>
        </p>
        @if (Model.WrongCredential)
        {
            <div class="alert alert-danger">
                Ingresaste mal tu nombre de usuario o contraseña
            </div>
        }
        @if (Model.NotVerifiedEmail)
        {
            <div class="alert alert-danger">
                Por favor, verifica tu correo electrónico. Hemos enviado un correo.
            </div>
        }
        <div class="form-group">
            <label for="email_form_control">Correo electrónico</label>
            <input type="email" name="email" id="email_form_control" class="form-control"
                   value='@ViewData["username_field"]' required>
        </div>
        <div class="form-group">
            <label for="password_form_control">Contraseña</label>
            <input type="password" name="password"
                   id="password_form_control" class="form-control" required>
        </div>
        <div class="form-group">
            <a asp-page="ForgotPassword">Olvidé mi contraseña</a>
        </div>
        <div class="d-flex justify-content-center">
            <button class="btn btn-primary" type="submit">Iniciar sesión</button>
        </div>
        <div class="mt-auto p-3">
            <p>Necesitamos de los cookies para mantener tu sesión activa en este navegador. ¡No deshabilites los cookies!</p>
        </div>
    </form>
</div>
<div class="col-lg-5 col-md-6 justify-content-end align-items-center">
    <div class="sign-in-up-form">
        <h2>Inicia sesión con proveedor externo</h2>
        <p>Nos conectaremos con el proveedor para registrarte o iniciar sesión en Isolaatti.</p>
        <p>Despues de dar clic en el botón, se te redireccionará a la página de autenticación del proveedor. Solo atiende la página del proveedor y espera.</p>
        <div id="firebaseui-auth-container"></div>
    </div>
</div>